<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Snake Game with AI</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython.min.js"></script>
    <style>
        canvas {
            border: 1px solid black;
        }
        #startButton {
            margin: 20px;
            padding: 10px 20px;
            font-size: 16px;
        }
    </style>
</head>
<body onload="brython()">
    <h1>Snake Game with AI</h1>
    <button id="startButton">開始遊戲</button>
    <canvas id="gameCanvas" width="640" height="480"></canvas>
    <script type="text/python">
        from browser import document, html, timer
        import random

        # Constants
        WIDTH, HEIGHT = 640, 480
        CELL_SIZE = 20
        UP, RIGHT, DOWN, LEFT = 0, 1, 2, 3
        BLACK = "black"
        GREEN = "green"
        RED = "red"

        class Snake:
            def __init__(self):
                self.position = [100, 50]
                self.body = [[100, 50], [90, 50], [80, 50]]
                self.direction = RIGHT

            def change_direction(self, dir):
                if dir == UP and self.direction != DOWN:
                    self.direction = UP
                if dir == DOWN and self.direction != UP:
                    self.direction = DOWN
                if dir == LEFT and self.direction != RIGHT:
                    self.direction = LEFT
                if dir == RIGHT and self.direction != LEFT:
                    self.direction = RIGHT

            def move(self, food_pos):
                if self.direction == UP:
                    self.position[1] -= CELL_SIZE
                if self.direction == DOWN:
                    self.position[1] += CELL_SIZE
                if self.direction == LEFT:
                    self.position[0] -= CELL_SIZE
                if self.direction == RIGHT:
                    self.position[0] += CELL_SIZE

                self.body.insert(0, list(self.position))
                if self.position == food_pos:
                    return True
                else:
                    self.body.pop()
                    return False

            def check_collision(self):
                if self.position[0] < 0 or self.position[0] >= WIDTH:
                    return True
                if self.position[1] < 0 or self.position[1] >= HEIGHT:
                    return True
                for block in self.body[1:]:
                    if self.position == block:
                        return True
                return False

            def get_head_position(self):
                return self.position

            def get_body(self):
                return self.body

        class Game:
            def __init__(self):
                self.snake = Snake()
                self.food_pos = self.spawn_food()
                self.running = False

            def spawn_food(self):
                return [random.randrange(1, (WIDTH // CELL_SIZE)) * CELL_SIZE,
                        random.randrange(1, (HEIGHT // CELL_SIZE)) * CELL_SIZE]

            def render(self):
                canvas = document["gameCanvas"]
                ctx = canvas.getContext("2d")
                ctx.fillStyle = BLACK
                ctx.fillRect(0, 0, WIDTH, HEIGHT)
                for pos in self.snake.get_body():
                    ctx.fillStyle = GREEN
                    ctx.fillRect(pos[0], pos[1], CELL_SIZE, CELL_SIZE)
                ctx.fillStyle = RED
                ctx.fillRect(self.food_pos[0], self.food_pos[1], CELL_SIZE, CELL_SIZE)

            def reset(self):
                self.snake = Snake()
                self.food_pos = self.spawn_food()
                self.running = False

        def main():
            game = Game()

            def update():
                if game.running:
                    if game.snake.move(game.food_pos):
                        game.food_pos = game.spawn_food()
                    if game.snake.check_collision():
                        game.reset()
                    game.render()

            def start_game(event):
                if not game.running:
                    game.running = True
                    game.reset()
                    timer.set_interval(update, 100)

            start_button = document["startButton"]
            start_button.bind("click", start_game)

        main()
    </script>
</body>
</html>
